<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>Polity Quiz</title>
    <!-- Updated Favicon with 'P' for Polity and Indigo color -->
    <link
      rel="icon"
      type="image/svg+xml"
      href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><linearGradient id=%22g%22 x1=%220%25%22 y1=%220%25%22 x2=%22100%25%22 y2=%22100%25%22><stop offset=%220%25%22 stop-color=%22%234f46e5%22/><stop offset=%22100%25%22 stop-color=%22%234338ca%22/></linearGradient><rect width=%22100%22 height=%22100%22 rx=%2230%22 fill=%22url(%23g)%22/><text x=%2250%22 y=%2250%22 dominant-baseline=%22central%22 text-anchor=%22middle%22 font-family=%22sans-serif%22 font-weight=%22900%22 font-size=%2260%22 fill=%22white%22>P</text></svg>"
    />
    <script
      src="https://unpkg.com/react@18/umd/react.production.min.js"
      crossorigin
    ></script>
    <script
      src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"
      crossorigin
    ></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Load Quiz Data -->
    <script src="quiz-data.js"></script>
    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              // Custom very dark gray for cards in pitch black mode
              "gray-950": "#0a0a0a",
            },
            animation: {
              "fade-in": "fadeIn 0.5s ease-out",
              "slide-up": "slideUp 0.3s ease-out",
              "bounce-slow": "bounce 3s infinite",
              "scale-in": "scaleIn 0.3s ease-out",
            },
            keyframes: {
              fadeIn: { "0%": { opacity: "0" }, "100%": { opacity: "1" } },
              slideUp: {
                "0%": { opacity: "0", transform: "translateY(10px)" },
                "100%": { opacity: "1", transform: "translateY(0)" },
              },
              scaleIn: {
                "0%": { opacity: "0", transform: "scale(0.9)" },
                "100%": { opacity: "1", transform: "scale(1)" },
              },
            },
          },
        },
      };
    </script>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Helvetica, Arial, sans-serif;
      }
      /* Custom scrollbar */
      ::-webkit-scrollbar {
        width: 6px;
        height: 6px;
      }
      ::-webkit-scrollbar-thumb {
        background: #cbd5e1;
        border-radius: 4px;
      }
      .dark ::-webkit-scrollbar-thumb {
        background: #333;
      }
      /* Prevent tap highlight on mobile */
      * {
        -webkit-tap-highlight-color: transparent;
      }
    </style>
  </head>
  <!-- MODIFICATION: dark:bg-black for pitch black theme -->
  <body
    class="bg-gray-50 dark:bg-black text-gray-900 dark:text-gray-100 h-[100dvh] overflow-hidden transition-colors duration-200"
  >
    <div id="root" class="h-full"></div>

    <script type="text/babel">
      const { useState, useEffect, useCallback, memo } = React;

      // =========================================
      // ERROR BOUNDARY
      // =========================================
      class ErrorBoundary extends React.Component {
        constructor(props) {
          super(props);
          this.state = { hasError: false, error: null };
        }
        static getDerivedStateFromError(error) {
          return { hasError: true, error };
        }
        componentDidCatch(error, errorInfo) {
          console.error("ErrorBoundary caught error", error, errorInfo);
        }
        render() {
          if (this.state.hasError) {
            return (
              <div className="h-full flex flex-col items-center justify-center p-6 text-center dark:bg-black">
                <h1 className="text-2xl font-bold mb-2 text-indigo-600">
                  Something went wrong
                </h1>
                <button
                  onClick={() => window.location.reload()}
                  className="px-6 py-2 bg-indigo-600 text-white rounded-full"
                >
                  Reload App
                </button>
              </div>
            );
          }
          return this.props.children;
        }
      }

      // =========================================
      // PARSER ENGINE
      // =========================================
      function parseData() {
        if (typeof window.QUIZ_DATA_TEXT === "undefined")
          throw new Error("quiz-data.js NOT FOUND.");
        // Data structure supports multiple subjects, though only Polity is currently loaded
        const data = {};
        let sub = null,
          chap = null,
          q = null,
          mode = null;
        const lines = window.QUIZ_DATA_TEXT.split("\n");

        for (let line of lines) {
          line = line.trim();
          if (!line || line.startsWith("//")) continue;

          // Parse Subject
          if (line.startsWith("[SUBJECT:")) {
            sub = line
              .match(/\[SUBJECT:(.*)\]/i)[1]
              .trim()
              .toLowerCase();
            data[sub] = data[sub] || []; // Initialize subject array
            chap = null;
            continue;
          }
          // Parse Chapter
          if (line.startsWith("[CHAPTER:")) {
            if (sub && data[sub]) {
              chap = {
                id: Math.random().toString(36).substr(2, 9),
                title: line.match(/\[CHAPTER:(.*)\]/i)[1].trim(),
                questions: [],
              };
              data[sub].push(chap);
            }
            continue;
          }
          // Parse Question Start
          if (line.match(/^Q[:\.]/i)) {
            if (chap) {
              q = {
                question: line.replace(/^Q[:\.]\s*/i, ""),
                options: [],
                correctAnswer: 0,
              };
              chap.questions.push(q);
              mode = "Q";
            }
            continue;
          }
          // Parse Options (A), B), C)...)
          const optMatch = line.match(/^[\(\[]?([A-D])[\)\]\.]\s*(.*)/i);
          if (optMatch) {
            if (q) {
              q.options.push(optMatch[2]);
              mode = "OPT";
            }
            continue;
          }
          // Parse Answer
          const ansMatch = line.match(/^(ANS|ANSWER)[:\.]\s*([A-D])/i);
          if (ansMatch) {
            if (q)
              q.correctAnswer = ansMatch[2].toUpperCase().charCodeAt(0) - 65;
            mode = null;
            continue;
          }
          // Multiline Question support
          if (mode === "Q" && q && !line.startsWith("[")) {
            q.question += "\n" + line;
          }
        }
        return data;
      }

      // =========================================
      // UI COMPONENTS
      // =========================================
      const Icon = memo(({ name, size = 24, className }) => {
        useEffect(() => {
          if (window.lucide) window.lucide.createIcons();
        }, [name]);
        return (
          <i
            data-lucide={name}
            style={{ fontSize: size, width: size, height: size }}
            className={className}
          ></i>
        );
      });

      const ThemeBtn = memo(({ dark, setDark }) => (
        <button
          onClick={() => setDark(!dark)}
          className="fixed top-4 right-4 z-50 p-2 rounded-full bg-white/10 backdrop-blur-md border border-gray-200 dark:border-gray-800 shadow-lg text-gray-800 dark:text-gray-200 transition-all hover:scale-110 active:scale-95"
        >
          <Icon name={dark ? "sun" : "moon"} size={20} />
        </button>
      ));

      function QuizApp() {
        const [data, setData] = useState(null);
        const [view, setView] = useState("loading");
        // Persist dark mode preference
        const [dark, setDark] = useState(
          () => localStorage.getItem("darkMode") === "true"
        );
        const [sub, setSub] = useState(null);
        const [chap, setChap] = useState(null);
        const [qIdx, setQIdx] = useState(0);
        const [ans, setAns] = useState({});
        const [status, setStatus] = useState({});
        const [qKey, setQKey] = useState(0);

        useEffect(() => {
          try {
            setData(parseData());
            setView("welcome");
          } catch (e) {
            console.error("Quiz Data Load Error:", e);
            // Use a custom message box instead of alert()
            // Here we just set an error state for simplicity in this single file app
            setView("error");
          }
        }, []);

        useEffect(() => {
          document.documentElement.classList.toggle("dark", dark);
          localStorage.setItem("darkMode", dark);
        }, [dark]);

        useEffect(() => {
          if (window.lucide) window.lucide.createIcons();
        });

        const start = useCallback((c) => {
          setChap(c);
          setQIdx(0);
          setAns({});
          setStatus({ 0: "visited" });
          setView("quiz");
          setQKey(Date.now());
        }, []);

        const handleOpt = useCallback(
          (i) => {
            if (ans[qIdx] === undefined) {
              setAns((p) => ({ ...p, [qIdx]: i }));
              setStatus((p) => ({ ...p, [qIdx]: "ans" }));
            }
          },
          [ans, qIdx]
        );

        const nav = useCallback(
          (d) => {
            const n = qIdx + d;
            if (n >= 0 && n < chap.questions.length) {
              setQIdx(n);
              if (!status[n]) setStatus((p) => ({ ...p, [n]: "visited" }));
              setQKey(Date.now()); // Use timestamp for more reliable remounting
            } else if (d > 0) {
              setView("result");
            }
          },
          [qIdx, chap, status]
        );

        // --- VIEWS ---

        if (view === "loading")
          return (
            <div className="h-screen flex items-center justify-center animate-pulse text-xl dark:text-white">
              Loading Quiz Data...
            </div>
          );

        if (view === "error")
           return (
            <div className="h-full flex flex-col items-center justify-center p-6 text-center dark:bg-black">
              <h1 className="text-2xl font-bold mb-2 text-indigo-600">
                Quiz Data Error
              </h1>
              <p className="text-gray-600 dark:text-gray-400 mb-6">
                Unable to load quiz questions. Please check the data source.
              </p>
              <button
                onClick={() => window.location.reload()}
                className="px-6 py-2 bg-indigo-600 text-white rounded-full transition-all hover:bg-indigo-700"
              >
                Reload App
              </button>
            </div>
           );

        if (view === "welcome")
          return (
            <div className="h-full flex flex-col items-center justify-center p-6 relative overflow-hidden">
              <ThemeBtn dark={dark} setDark={setDark} />
              <div className="text-center animate-fade-in z-10 max-w-md">
                {/* Icon changed to scale and color to indigo */}
                <div className="mb-8 inline-flex p-6 bg-gradient-to-tr from-indigo-600 to-indigo-800 rounded-[2rem] shadow-2xl rotate-6 hover:rotate-0 transition-all duration-500">
                  <Icon name="scale" size={72} className="text-white" />
                </div>
                <h1 className="text-5xl font-extrabold mb-6 leading-tight">
                  Master <br />
                  <span className="bg-clip-text text-transparent bg-gradient-to-r from-indigo-600 to-indigo-800">
                    Polity
                  </span>
                </h1>
                <p className="text-gray-600 dark:text-gray-400 mb-8 text-lg">
                  Test your knowledge of the Constitution and Governance with our
                  interactive quizzes.
                </p>
                <button
                  onClick={() => setView("subjects")}
                  className="px-10 py-4 text-xl font-bold text-white bg-indigo-600 hover:bg-indigo-700 rounded-2xl shadow-xl shadow-indigo-500/20 hover:scale-105 hover:shadow-indigo-500/40 transition-all active:scale-95"
                >
                  Start Learning
                </button>
              </div>
              {/* Background decoration color changed to indigo */}
              <div className="absolute -bottom-32 -left-32 w-96 h-96 bg-indigo-500/10 dark:bg-indigo-500/5 rounded-full blur-3xl pointer-events-none"></div>
              <div className="absolute -top-32 -right-32 w-96 h-96 bg-indigo-500/10 dark:bg-indigo-500/5 rounded-full blur-3xl pointer-events-none"></div>
            </div>
          );

        if (view === "subjects")
          return (
            <div className="h-full p-6 overflow-y-auto">
              <ThemeBtn dark={dark} setDark={setDark} />
              <div className="max-w-6xl mx-auto mt-10 animate-slide-up">
                <header className="mb-8">
                  <button
                    onClick={() => setView("welcome")}
                    className="flex items-center text-gray-500 dark:text-gray-400 hover:text-indigo-500 transition-colors mb-6"
                  >
                    <Icon name="arrow-left" size={20} className="mr-2" /> Back
                    to Home
                  </button>
                  <h2 className="text-4xl font-bold dark:text-white">
                    Select Subject
                  </h2>
                </header>

                {/* Modified Grid to Center the single card */}
                <div className="flex justify-center">
                  {/* Subject details updated for Polity/Indigo theme */}
                  {[
                    {
                      id: "polity",
                      name: "Polity",
                      icon: "scale",
                      c: "from-indigo-600 to-indigo-800",
                    },
                  ].map((s) => (
                    <button
                      key={s.id}
                      onClick={() => {
                        setSub(s);
                        setView("chapters");
                      }}
                      className="relative w-full max-w-sm p-8 bg-white dark:bg-gray-950 rounded-[2rem] shadow-xl hover:shadow-2xl transition-all text-left border border-gray-100 dark:border-gray-800 overflow-hidden group hover:-translate-y-1"
                    >
                      <div
                        className={`absolute inset-0 opacity-0 group-hover:opacity-5 bg-gradient-to-br ${s.c} transition-opacity duration-500`}
                      />
                      <div
                        className={`inline-flex p-4 rounded-2xl bg-gradient-to-br ${s.c} text-white mb-6 shadow-lg`}
                      >
                        <Icon name={s.icon} size={32} />
                      </div>
                      <h3 className="text-3xl font-bold mb-2 dark:text-white">
                        {s.name}
                      </h3>
                      <p className="text-gray-500 dark:text-gray-400 font-medium flex items-center">
                        <Icon
                          name="book-open"
                          size={16}
                          className="mr-2 opacity-70"
                        />
                        {data[s.id]?.length || 0} Chapters
                      </p>
                    </button>
                  ))}
                </div>
              </div>
            </div>
          );

        if (view === "chapters")
          return (
            <div className="h-full p-6 overflow-y-auto">
              <ThemeBtn dark={dark} setDark={setDark} />
              <div className="max-w-3xl mx-auto mt-10 animate-slide-up">
                <header className="mb-10">
                  <button
                    onClick={() => setView("subjects")}
                    className="flex items-center text-gray-500 dark:text-gray-400 hover:text-indigo-500 transition-colors mb-6"
                  >
                    <Icon name="arrow-left" size={20} className="mr-2" /> Back
                    to Subjects
                  </button>
                  <div className="flex items-center">
                    {/* Icon and color updated */}
                    <div
                      className={`p-3 rounded-2xl mr-4 bg-gradient-to-br ${sub.c} text-white shadow-lg`}
                    >
                      <Icon name={sub.icon} size={28} />
                    </div>
                    <h2 className="text-3xl font-bold dark:text-white">
                      {sub.name} Chapters
                    </h2>
                  </div>
                </header>
                <div className="space-y-4">
                  {(data[sub.id] || []).length === 0 ? (
                    <div className="text-center p-10 text-gray-500 dark:text-gray-400 bg-white dark:bg-gray-950 rounded-2xl border dark:border-gray-800">
                      No chapters found for this subject yet.
                    </div>
                  ) : (
                    (data[sub.id] || []).map((c, i) => (
                      <button
                        key={c.id}
                        onClick={() => start(c)}
                        className="w-full flex items-center justify-between p-5 bg-white dark:bg-gray-950 rounded-2xl shadow-sm hover:shadow-md transition-all border border-gray-100 dark:border-gray-800 group hover:border-indigo-500 dark:hover:border-indigo-500/50"
                      >
                        <div className="flex items-center">
                          {/* Color updated */}
                          <span className="w-12 h-12 rounded-xl bg-indigo-50 dark:bg-indigo-900/20 text-indigo-600 dark:text-indigo-400 font-bold flex items-center justify-center mr-5 group-hover:bg-indigo-600 group-hover:text-white transition-colors">
                            {i + 1}
                          </span>
                          <div className="text-left">
                            <h3 className="text-lg font-bold dark:text-gray-100 group-hover:text-indigo-600 dark:group-hover:text-indigo-400 transition-colors">
                              {c.title}
                            </h3>
                            <p className="text-sm text-gray-500 dark:text-gray-400 mt-1">
                              {c.questions.length} Questions
                            </p>
                          </div>
                        </div>
                        <div className="w-10 h-10 rounded-full flex items-center justify-center bg-gray-50 dark:bg-gray-900 group-hover:bg-indigo-50 dark:group-hover:bg-indigo-900/20 transition-colors">
                          <Icon
                            name="chevron-right"
                            className="text-gray-400 group-hover:text-indigo-500 transition-colors"
                            size={20}
                          />
                        </div>
                      </button>
                    ))
                  )}
                </div>
              </div>
            </div>
          );

        if (view === "quiz") {
          const curQ = chap.questions[qIdx];
          // Error handling for malformed questions
          if (!curQ || !curQ.options || curQ.options.length < 2) {
            return (
              <div className="h-full flex flex-col items-center justify-center p-6 dark:bg-black">
                <h2 className="text-indigo-500 text-2xl font-bold mb-4">
                  Data Error
                </h2>
                <p className="text-gray-600 dark:text-gray-400 mb-6">
                  Question {qIdx + 1} is missing data.
                </p>
                <button
                  onClick={() => nav(-1)}
                  className="px-6 py-2 bg-gray-200 dark:bg-gray-800 dark:text-white rounded-full"
                >
                  Go Back
                </button>
              </div>
            );
          }
          const isAns = ans[qIdx] !== undefined;

          return (
            <div className="h-full flex flex-col md:flex-row">
              <ThemeBtn dark={dark} setDark={setDark} />
              {/* Main Question Area */}
              <main className="flex-1 h-full flex flex-col p-4 md:p-6 overflow-y-auto no-scrollbar">
                <div className="max-w-3xl mx-auto w-full flex-1 flex flex-col">
                  {/* Top Bar */}
                  <div className="flex justify-between items-center mb-6">
                    <button
                      onClick={() => setView("chapters")}
                      className="flex items-center text-gray-500 dark:text-gray-400 hover:text-indigo-500 transition-colors px-3 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-900"
                    >
                      <Icon name="x" size={20} className="mr-1" /> Quit
                    </button>
                    <div className="text-sm font-bold text-gray-500 dark:text-gray-400">
                      {chap.title}
                    </div>
                  </div>

                  {/* Progress Bar - Color updated */}
                  <div className="h-2 bg-gray-100 dark:bg-gray-900 rounded-full mb-6 overflow-hidden">
                    <div
                      className="h-full bg-indigo-600 transition-all duration-300 ease-out"
                      style={{
                        width: `${((qIdx + 1) / chap.questions.length) * 100}%`,
                      }}
                    />
                  </div>

                  {/* Question Card - Key change forces remount on new question */}
                  <div
                    key={qKey}
                    className="bg-white dark:bg-gray-950 rounded-[2rem] shadow-xl p-6 md:p-10 border border-gray-100 dark:border-gray-800 mb-6 flex-1 overflow-y-auto animate-slide-up"
                  >
                    <div className="flex items-center mb-6">
                      {/* Color updated */}
                      <span className="px-4 py-1.5 text-sm font-bold text-indigo-600 dark:text-indigo-400 bg-indigo-50 dark:bg-indigo-900/30 rounded-full mr-4">
                        Question {qIdx + 1} of {chap.questions.length}
                      </span>
                    </div>
                    <h2 className="text-xl md:text-3xl font-bold mb-8 leading-snug dark:text-gray-100 whitespace-pre-line">
                      {curQ.question}
                    </h2>
                    <div className="space-y-4">
                      {curQ.options.map((o, i) => {
                        const sel = ans[qIdx] === i;
                        const cor = curQ.correctAnswer === i;
                        // Complex logic for option styling based on state
                        let cls =
                          "w-full text-left p-4 md:p-5 rounded-2xl border-2 transition-all flex items-center group ";
                        if (isAns) {
                          if (sel && cor)
                            cls +=
                              "bg-green-50 border-green-500 dark:bg-green-900/20 dark:border-green-500/50 text-green-800 dark:text-green-400";
                          else if (sel && !cor)
                            cls +=
                              "bg-red-50 border-red-500 dark:bg-red-900/20 dark:border-red-500/50 text-red-800 dark:text-red-400";
                          else if (!sel && cor)
                            cls +=
                              "bg-green-50/50 border-green-300 dark:bg-green-900/10 dark:border-green-500/30 text-green-800 dark:text-green-400";
                          else
                            cls +=
                              "opacity-50 border-gray-100 dark:border-gray-800 dark:bg-gray-900";
                        } else {
                          // Color updated
                          cls +=
                            "bg-white dark:bg-gray-900 border-gray-200 dark:border-gray-800 hover:border-indigo-400 dark:hover:border-indigo-500 hover:shadow-md active:scale-[0.99]";
                        }

                        return (
                          <button
                            key={i}
                            disabled={isAns}
                            onClick={() => handleOpt(i)}
                            className={cls}
                          >
                            <span
                              className={`w-10 h-10 rounded-full flex items-center justify-center font-bold mr-4 flex-shrink-0 transition-colors ${
                                isAns && (sel || cor)
                                  ? "bg-transparent"
                                  : "bg-gray-100 dark:bg-gray-800 group-hover:bg-indigo-50 dark:group-hover:bg-indigo-900/30 group-hover:text-indigo-600" // Color updated
                              }`}
                            >
                              {String.fromCharCode(65 + i)}
                            </span>
                            <span className="flex-1 text-lg dark:text-gray-200">
                              {o}
                            </span>
                            {isAns && sel && cor && (
                              <Icon
                                name="check-circle"
                                className="text-green-500 ml-3 flex-shrink-0"
                                size={24}
                              />
                            )}
                            {isAns && sel && !cor && (
                              <Icon
                                name="x-circle"
                                className="text-red-500 ml-3 flex-shrink-0"
                                size={24}
                              />
                            )}
                          </button>
                        );
                      })}
                    </div>
                  </div>

                  {/* Navigation */}
                  <div className="flex justify-between py-4">
                    <button
                      onClick={() => nav(-1)}
                      disabled={qIdx === 0}
                      className={`px-6 py-3 rounded-2xl font-bold flex items-center transition-all ${
                        qIdx === 0
                          ? "opacity-0 pointer-events-none"
                          : "bg-gray-100 dark:bg-gray-900 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-800"
                      }`}
                    >
                      <Icon name="arrow-left" size={20} className="mr-2" />{" "}
                      Previous
                    </button>
                    <button
                      onClick={() => nav(1)}
                      className="px-8 py-3 rounded-2xl font-bold text-white bg-indigo-600 hover:bg-indigo-700 shadow-lg hover:shadow-indigo-500/30 transition-all hover:scale-105 active:scale-95 flex items-center" // Color updated
                    >
                      {qIdx === chap.questions.length - 1
                        ? "Finish Quiz"
                        : "Next Question"}
                      <Icon
                        name={
                          qIdx === chap.questions.length - 1
                            ? "flag"
                            : "arrow-right"
                        }
                        size={20}
                        className="ml-2"
                      />
                    </button>
                  </div>
                </div>
              </main>

              {/* Sidebar / Bottom bar for question palette */}
              <aside className="w-full md:w-80 bg-white dark:bg-gray-950 border-t md:border-l border-gray-200 dark:border-gray-900 p-6 overflow-y-auto max-h-[30vh] md:max-h-full">
                <h3 className="font-bold mb-6 dark:text-white flex items-center">
                  <Icon name="layout-grid" className="mr-2" size={20} />
                  Question Palette
                </h3>
                <div className="grid grid-cols-5 gap-3">
                  {chap.questions.map((_, i) => {
                    const st = status[i];
                    let cls =
                      "aspect-square rounded-xl font-bold text-sm flex items-center justify-center border-2 transition-all ";
                    if (qIdx === i)
                      // Color updated
                      cls +=
                        "border-indigo-500 bg-indigo-50 dark:bg-indigo-900/20 text-indigo-600 dark:text-indigo-400 scale-110 shadow-md";
                    else if (st === "ans")
                      // Color updated
                      cls += "bg-indigo-500 border-transparent text-white";
                    else if (st === "visited")
                      // Color updated
                      cls +=
                        "bg-indigo-100 dark:bg-indigo-900/30 border-transparent text-indigo-600 dark:text-indigo-400";
                    else
                      cls +=
                        "bg-gray-100 dark:bg-gray-900 border-transparent text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-800";

                    return (
                      <button
                        key={i}
                        onClick={() => {
                          setQIdx(i);
                          if (!st) setStatus((p) => ({ ...p, [i]: "visited" }));
                          setQKey(Date.now());
                        }}
                        className={cls}
                      >
                        {i + 1}
                      </button>
                    );
                  })}
                </div>
                <div className="mt-8 space-y-2 text-xs font-medium text-gray-500 dark:text-gray-400">
                  <div className="flex items-center">
                    {/* Color updated */}
                    <div className="w-3 h-3 rounded-full bg-indigo-500 mr-2"></div>{" "}
                    Answered
                  </div>
                  <div className="flex items-center">
                    {/* Color updated */}
                    <div className="w-3 h-3 rounded-full bg-indigo-100 dark:bg-indigo-900/30 mr-2"></div>{" "}
                    Visited
                  </div>
                  <div className="flex items-center">
                    <div className="w-3 h-3 rounded-full bg-gray-100 dark:bg-gray-900 mr-2"></div>{" "}
                    Not Visited
                  </div>
                </div>
              </aside>
            </div>
          );
        }

        if (view === "result") {
          let score = 0;
          chap.questions.forEach((q, i) => {
            if (ans[i] === q.correctAnswer) score++;
          });
          const pct = Math.round((score / chap.questions.length) * 100) || 0;
          const isPass = pct >= 60;

          return (
            <div className="h-full flex items-center justify-center p-6">
              <ThemeBtn dark={dark} setDark={setDark} />
              <div className="bg-white dark:bg-gray-950 p-8 md:p-12 rounded-[3rem] shadow-2xl text-center max-w-md w-full animate-scale-in border border-gray-100 dark:border-gray-800">
                <div className="relative inline-block">
                  {/* Color updated */}
                  <div
                    className={`absolute inset-0 blur-2xl opacity-50 ${
                      isPass ? "bg-indigo-500" : "bg-gray-500"
                    }`}
                  ></div>
                  <Icon
                    name={isPass ? "trophy" : "target"}
                    size={64}
                    className={`relative z-10 mx-auto mb-6 animate-bounce-slow ${
                      isPass ? "text-indigo-500" : "text-gray-400"
                    }`}
                  />
                </div>

                {/* Color updated */}
                <h2 className="text-4xl md:text-5xl font-extrabold mb-4 bg-clip-text text-transparent bg-gradient-to-r from-indigo-600 to-indigo-800">
                  {pct >= 90
                    ? "Legendary!"
                    : pct >= 80
                    ? "Outstanding!"
                    : pct >= 60
                    ? "Great Job!"
                    : "Keep Practicing!"}
                </h2>

                <div className="mb-8">
                  <div className="text-8xl font-black mb-2 dark:text-white tracking-tighter">
                    {pct}%
                  </div>
                  <div className="inline-block px-6 py-2 rounded-full bg-gray-100 dark:bg-gray-900 text-xl text-gray-600 dark:text-gray-300">
                    Score:{" "}
                    <b className={isPass ? "text-green-500" : "text-red-500"}>
                      {score}
                    </b>{" "}
                    / {chap.questions.length}
                  </div>
                </div>

                <div className="flex flex-col sm:flex-row gap-4">
                  <button
                    onClick={() => start(chap)}
                    className="flex-1 py-4 rounded-2xl bg-gray-100 dark:bg-gray-900 text-gray-700 dark:text-white font-bold flex justify-center items-center hover:bg-gray-200 dark:hover:bg-gray-800 transition-colors"
                  >
                    <Icon name="rotate-ccw" size={20} className="mr-2" /> Retry
                  </button>
                  <button
                    onClick={() => setView("subjects")}
                    className="flex-1 py-4 rounded-2xl bg-indigo-600 text-white font-bold flex justify-center items-center hover:bg-indigo-700 shadow-lg hover:shadow-indigo-500/30 transition-all" // Color updated
                  >
                    Finish
                  </button>
                </div>
              </div>
            </div>
          );
        }

        return null;
      }

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(
        <ErrorBoundary>
          <QuizApp />
        </ErrorBoundary>
      );
    </script>
  </body>
</html>